{{ define "main" }}
  {{ $showSidebar := .Site.Params.sidebar }}
  {{ if isset .Params "sidebar" }}
    {{ $showSidebar = .Params.sidebar }}
  {{ end }}

  {{ partial "verify" . }}
  {{ partial "header" . }}

  {{/* Resolve component from catalog using slug */}}
  {{ $slug := .Params.slug | default (urlize .Title) }}
  {{ $scratch := newScratch }}

  {{ range .Site.Data.catalog }}
    {{ if eq .slug $slug }}
      {{ $scratch.Set "component" . }}
    {{ end }}
  {{ end }}

  {{ $component := $scratch.Get "component" }}

  <gcds-container size="xl" main-container centered tag="main">
    <gcds-grid
      tag="section"
      columns="1fr"
      columns-desktop="{{ if $showSidebar }}1fr 3fr{{ else }}1fr{{ end }}"
      align-items="start"
      class="hydrated">

      {{ if $showSidebar }}
        <aside role="complementary">
          {{ partial "side-navigation" . }}
        </aside>
      {{ end }}

      <section class="mb-400">

        {{ if not $component }}

          {{ partial "heading" . }}
          <gcds-text>
            This component exists as a page, but no matching definition was found
            in the Aurora component catalog.
          </gcds-text>

        {{ else }}

          {{/* Title */}}
          <gcds-heading tag="h1">{{ $component.name }}</gcds-heading>

          {{ with $component.alias }}
            <gcds-text text-role="secondary" size="caption">
              Also known as: {{ . }}
            </gcds-text>
          {{ end }}

          {{ with $component.relationships.parent }}
            <gcds-text text-role="secondary" size="caption">
              Part of <a href="/components/{{ . }}/">{{ . | title }}</a>
            </gcds-text>
          {{ end }}

          {{ with $component.descriptions.long }}
            <gcds-text class="my-400">{{ . }}</gcds-text>
          {{ end }}

          {{/* Overview */}}
          <gcds-heading tag="h2">Overview</gcds-heading>
          <gcds-text>
            <strong>Category:</strong> {{ $component.category.hld }}<br>
            <strong>Type:</strong> {{ $component.category.type }}<br>
            <strong>Status:</strong> {{ $component.deployment.status }}<br>
            <strong>Version:</strong> {{ $component.deployment.version }}
          </gcds-text>

          {{/* Capabilities */}}
          {{ with $component.capabilities }}
            <gcds-heading tag="h2">Capabilities</gcds-heading>
            <ul>
              {{ range . }}
                <li>{{ . }}</li>
              {{ end }}
            </ul>
          {{ end }}

          {{/* Architecture */}}
          {{ with $component.architecture.role }}
            <gcds-heading tag="h2">Architecture Role</gcds-heading>
            <gcds-text>{{ . }}</gcds-text>
          {{ end }}

          {{/* Deployment */}}
          {{ with $component.deployment }}
            <gcds-heading tag="h2">Deployment</gcds-heading>
            <gcds-text>
              <strong>Deployed in:</strong> {{ delimit .deployed_in ", " }}<br>
              <strong>Deployment model:</strong> {{ .deployment_model }}<br>
              <strong>Owner:</strong> {{ .ownership.team }}
            </gcds-text>
          {{ end }}

          {{/* Implementation (GitHub + explicit Argo linkage) */}}
          {{ with $component.references.charts }}
            <gcds-heading tag="h2">Implementation</gcds-heading>
            <gcds-text>
              <strong>GitHub:</strong>
              <a href="{{ .repo }}/tree/main/{{ .path }}">
                {{ .repo }}/{{ .path }}
              </a>
            </gcds-text>
            <gcds-text text-role="secondary" size="caption">
              This repository is consumed by Argo CD to deploy and manage the
              {{ $component.name }} platform component in Aurora.
            </gcds-text>
          {{ end }}

          {{/* Project links */}}
          {{ with $component.project }}
            <gcds-heading tag="h2">Project</gcds-heading>
            <ul>
              {{ with .homepage }}
                <li><a href="{{ . }}">Project homepage</a></li>
              {{ end }}
              {{ with .documentation }}
                <li><a href="{{ . }}">Documentation</a></li>
              {{ end }}
              {{ with .cncf_landscape }}
                <li><a href="{{ . }}">CNCF Landscape</a></li>
              {{ end }}
            </ul>
          {{ end }}

          {{/* Operational references */}}
          {{ with $component.references }}
            <gcds-heading tag="h2">Operational References</gcds-heading>
            <ul>
              {{ range .adr }}
                <li>{{ . }}</li>
              {{ end }}
              {{ range .runbooks }}
                <li>{{ . }}</li>
              {{ end }}
            </ul>
          {{ end }}

        {{ end }}

        {{ partial "date-modified" . }}

      </section>
    </gcds-grid>
  </gcds-container>
{{ end }}
