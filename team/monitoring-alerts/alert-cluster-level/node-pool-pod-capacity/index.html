<!doctype html><html dir=ltr lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=5"><title>Node Pool Capacity Alerts | Aurora
</title><link rel=icon href=/favicon.ico type=image/x-icon><link rel=preload href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css as=style crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.design-system.alpha.canada.ca/@cdssnc/gcds-utility@1.10.0/dist/gcds-utility.min.css><link rel=stylesheet href=https://cdn.design-system.alpha.canada.ca/@cdssnc/gcds-components@0.42.0/dist/gcds/gcds.css><script async type=module src=https://cdn.design-system.alpha.canada.ca/@cdssnc/gcds-components@0.42.0/dist/gcds/gcds.esm.js></script><link rel=stylesheet href=/scss/main.css><link rel=stylesheet href=/scss/custom.css><style>html{font-size:16px}body{font-size:var(--gcds-font-sizes-text);line-height:var(--gcds-line-heights-text);color:var(--gcds-color-grayscale-1000);font-family:var(--gcds-font-families-body),sans-serif;margin:0;animation:fade .05s forwards ease-in-out}</style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css></head><body style=margin:0 class=character-limit><main><gcds-container centered size=md><gcds-text size=caption style="text-align: center;"><strong>Alpha</strong>&nbsp;&nbsp;This is an experimental service.</gcds-text>
</gcds-container><gcds-header lang=en lang-href signature-variant=colour skip-to-href=#><gcds-search lang=en slot=search action=/sr/srb.html placeholder=Aurora></gcds-search><gcds-top-nav slot=menu label="Top navigation" alignment=right><gcds-nav-link href=/ slot=home>GC Cloud One: Aurora
</gcds-nav-link><gcds-nav-group open-trigger=Platform menu-label=Platform><gcds-nav-link href=/proposal>Proposal
</gcds-nav-link><gcds-nav-link href=/vision>Vision
</gcds-nav-link><gcds-nav-link href=/architecture>Architecture
</gcds-nav-link></gcds-nav-group><gcds-nav-group open-trigger=Team menu-label=Team><gcds-nav-link href=/team/sop>Standard Operating Procedures
</gcds-nav-link><gcds-nav-link href=/team/monitoring-alerts/>Monitoring
</gcds-nav-link><gcds-nav-link href=/team/appendix>Appendix
</gcds-nav-link></gcds-nav-group><gcds-nav-group open-trigger=Community menu-label=Community><gcds-nav-link href=/get-involved>Get involved
</gcds-nav-link><gcds-nav-link href=/rules-of-engagement>Rules of Engagement
</gcds-nav-link><gcds-nav-link href=/technical-advisory-group>Technical Advisory Group
</gcds-nav-link></gcds-nav-group><gcds-nav-link href=/contact slot>Contact us
</gcds-nav-link></gcds-top-nav><gcds-breadcrumbs slot=breadcrumb><gcds-breadcrumbs-item href="https://hosting-services-hebergement.canada.ca/s/gc-cloud-one?language=en_US">GC Cloud One</gcds-breadcrumbs-item>
<gcds-breadcrumbs-item href=/>Aurora</gcds-breadcrumbs-item>
<gcds-breadcrumbs-item href=/team/>Team Guide</gcds-breadcrumbs-item>
<gcds-breadcrumbs-item href=/team/monitoring-alerts/>Monitoring and Alerting</gcds-breadcrumbs-item>
<gcds-breadcrumbs-item href=/team/monitoring-alerts/alert-cluster-level/>Cluster Level Alerts</gcds-breadcrumbs-item>
</gcds-breadcrumbs></gcds-header><gcds-container size=xl main-container centered tag=main><gcds-grid tag=section columns=1fr columns-desktop="
        1fr 3fr
      " align-items=start class=hydrated><aside role=complementary><gcds-side-nav label="Team Guide"><gcds-nav-link href=/team/>Team Guide
</gcds-nav-link><gcds-nav-group open-trigger="Standard Operating Procedures" menu-label="Standard Operating Procedures"><gcds-nav-link href=/team/standard-operating-procedures/>Standard Operating Procedures
</gcds-nav-link><gcds-nav-link href=/team/standard-operating-procedures/adding-components-aurora-platform-chart/>Adding components to Aurora Platform Charts
</gcds-nav-link><gcds-nav-link href=/team/standard-operating-procedures/backup-disaster-recovery/>Backup and Disaster Recovery
</gcds-nav-link><gcds-nav-link href=/team/standard-operating-procedures/bootstrap-cluster/>Bootstrap Cluster
</gcds-nav-link><gcds-nav-link href=/team/standard-operating-procedures/infrastructure-and-configuration-management/>Infrastructure and Configuration Management
</gcds-nav-link><gcds-nav-link href=/team/standard-operating-procedures/issue-naming/>Issue and PR Naming Conventions
</gcds-nav-link><gcds-nav-link href=/team/standard-operating-procedures/enterprise-landing-zone/>Onboarding process for the Enterprise Landing Zone
</gcds-nav-link></gcds-nav-group><gcds-nav-group open-trigger="Monitoring and Alerting" menu-label="Monitoring and Alerting" open><gcds-nav-link href=/team/monitoring-alerts/>Monitoring and Alerting
</gcds-nav-link><gcds-nav-link href=/team/monitoring-alerts/prometheus/>Prometheus
</gcds-nav-link><gcds-nav-link href=/team/monitoring-alerts/prometheus-operator/>Prometheus Operator
</gcds-nav-link><gcds-nav-link href=/team/monitoring-alerts/alertmanager/>Alertmanager
</gcds-nav-link><gcds-nav-link href=/team/monitoring-alerts/blackbox-exporter/>Blackbox Exporter
</gcds-nav-link><gcds-nav-group open-trigger="Cluster Level Alerts" menu-label="Cluster Level Alerts" open><gcds-nav-link href=/team/monitoring-alerts/alert-cluster-level/>Cluster Level Alerts
</gcds-nav-link><gcds-nav-link href=/team/monitoring-alerts/alert-cluster-level/cert-manager/>Cert Manager Alerts
</gcds-nav-link><gcds-nav-link href=/team/monitoring-alerts/alert-cluster-level/dns/>DNS Alerts
</gcds-nav-link><gcds-nav-link href=/team/monitoring-alerts/alert-cluster-level/node/>Node Alerts
</gcds-nav-link><gcds-nav-link href=/team/monitoring-alerts/alert-cluster-level/node-pool-pod-capacity/ current=true>Node Pool Capacity Alerts
</gcds-nav-link><gcds-nav-link href=/team/monitoring-alerts/alert-cluster-level/probe-failure/>Probe Failure Alerts
</gcds-nav-link><gcds-nav-link href=/team/monitoring-alerts/alert-cluster-level/prometheus-storage-low/>Prometheus Storage Alerts
</gcds-nav-link><gcds-nav-link href=/team/monitoring-alerts/alert-cluster-level/ssl-cert-expiring-soon/>SSL Certificate Alerts
</gcds-nav-link><gcds-nav-link href=/team/monitoring-alerts/alert-cluster-level/velero/>Velero Alerts
</gcds-nav-link></gcds-nav-group><gcds-nav-group open-trigger="Namespace Level Alerts" menu-label="Namespace Level Alerts"><gcds-nav-link href=/team/monitoring-alerts/alert-namespace-level/>Namespace Level Alerts
</gcds-nav-link><gcds-nav-link href=/team/monitoring-alerts/alert-namespace-level/container/>Container Alerts
</gcds-nav-link><gcds-nav-link href=/team/monitoring-alerts/alert-namespace-level/job/>Job Alerts
</gcds-nav-link><gcds-nav-link href=/team/monitoring-alerts/alert-namespace-level/persistent-volume-claims/>Persistent Volume Claim Alerts
</gcds-nav-link><gcds-nav-link href=/team/monitoring-alerts/alert-namespace-level/pod-not-ready/>Pod Alerts
</gcds-nav-link></gcds-nav-group></gcds-nav-group><gcds-nav-group open-trigger=Appendix menu-label=Appendix><gcds-nav-link href=/team/appendix/>Appendix
</gcds-nav-link><gcds-nav-link href=/team/appendix/acronyms/>Acronyms
</gcds-nav-link><gcds-nav-link href=/team/appendix/lexicon/>Lexicon</gcds-nav-link></gcds-nav-group></gcds-side-nav></aside><section class=mb-400><gcds-heading tag=h1>Node Pool Capacity Alerts</gcds-heading>
<gcds-alert alert-role=danger container=full heading="Avis de traduction" hide-close-btn=true hide-role-icon=false is-fixed=false class="hydrated mb-400"><gcds-text>Veuillez noter que ce document est actuellement en cours de développement actif et pourrait être sujet à des révisions. Une fois terminé, il sera entièrement traduit en français et mis à disposition dans sa version finale.</gcds-text>
</gcds-alert><gcds-text character-limit=true>Node pool pod capacity alerts are configured to occur at the cluster level. As defined in the
<gcds-link href=https://kubernetes.io/docs/concepts/architecture/nodes/>official Kubernetes documentation</gcds-link>, Kubernetes runs workloads by placing containers into pods to run on nodes. Each node is managed by the control plane and contains the services necessary to run pods.
<gcds-link href=https://kubernetes.io/docs/setup/best-practices/cluster-large/>Kubernetes is designed to accommodate</gcds-link> no more than 110 pods per node. However, when nodes are created <code>max-pods</code> is set to a hard limit of 90 pods per node. When a particular node reaches a certain threshold, the following alerts are triggered:</gcds-text><ul><li><strong>NodepoolReachingPodCapacity</strong>: Nodepool pod capacity is over 80% used.</li><li><strong>NodepoolPodsFull</strong>: Nodepool pod capacity is over 95% used.</li></ul><gcds-text character-limit=true>Terminated (Succeeded or Failed) pods are not counted for these alerts because they do not prevent the scheduling of other pods onto the nodes.</gcds-text>
<gcds-heading tag=h2 id=alert-nodepoolreachingpodcapacity character-limit=true>Alert: NodepoolReachingPodCapacity<gcds-link href=#alert-nodepoolreachingpodcapacity class=pilcrow>¶</gcds-link></gcds-heading>
<gcds-text character-limit=true>This alert is triggered when the available pod capacity in the node pool has met or exceeded an 80% usage threshold. This alert is considered to have a <em>Minor</em> severity because issues are not expected as long as some pod capacity remains available. However, it serves as a warning that the nodepool may be in need of scaling soon, or that one or more workloads may be bursting to an unexpected extent.</gcds-text>
<gcds-text character-limit=true>When
<gcds-link href=https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/>assigning pods to nodes</gcds-link>, pods can be constrained so that they are restricted to run on a particular node(s), or to prefer to run on particular nodes. In general, the scheduler will automatically do a reasonable placement based on unused resources. However, there are some circumstances where pods control which node pools they constrain their deployments to via a label selector, <code>nodeSelector</code> or <code>NodeAffinity</code>.</gcds-text>
<gcds-heading tag=h2 id=alert-nodepoolpodsfull character-limit=true>Alert: NodepoolPodsFull<gcds-link href=#alert-nodepoolpodsfull class=pilcrow>¶</gcds-link></gcds-heading>
<gcds-text character-limit=true>A more severe version of the <em>NodepoolReachingPodCapacity</em> alert, this alert has a <em>Critical severity</em> and is triggered when the available pod capacity in the node pool has met or exceeded a 95% usage threshold. When no more pods may be deployed to a node pool, pods may fail to be scheduled. Running pods can also begin to misbehave when there is no remaining pod capacity.</gcds-text>
<gcds-heading tag=h2 id=resolution-process character-limit=true>Resolution Process<gcds-link href=#resolution-process class=pilcrow>¶</gcds-link></gcds-heading>
<gcds-text character-limit=true>As the pod capacity limits become low or full, the following are some checks to verify:</gcds-text><ul><li><gcds-text character-limit=true>Get the list of all node pools on the cluster:</gcds-text>
<gcds-text character-limit=true><code>kubectl top nodes</code></gcds-text></li><li><gcds-text character-limit=true>Verify the pod count that can be allocated to each node, this is important to see remaining node pool pod capacities:</gcds-text><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>&gt; ./get_pods_per_node.sh
</span></span><span style=display:flex><span>Node Name                             Pod Capacity  Allocatable Pods  Scheduled Pods
</span></span><span style=display:flex><span>1234k8s0100000l                       <span style=color:#ae81ff>90</span>            <span style=color:#ae81ff>90</span>                <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>k8s-elasticpool1-12348451-vmss00000p  <span style=color:#ae81ff>90</span>            <span style=color:#ae81ff>90</span>                <span style=color:#ae81ff>13</span>
</span></span><span style=display:flex><span>k8s-linuxpool1-12348451-vmss000012    <span style=color:#ae81ff>90</span>            <span style=color:#ae81ff>90</span>                <span style=color:#ae81ff>40</span>
</span></span><span style=display:flex><span>k8s-linuxpool1-12348451-vmss000013    <span style=color:#ae81ff>90</span>            <span style=color:#ae81ff>90</span>                <span style=color:#ae81ff>32</span>
</span></span><span style=display:flex><span>k8s-linuxpool1-12348451-vmss000014    <span style=color:#ae81ff>90</span>            <span style=color:#ae81ff>90</span>                <span style=color:#ae81ff>33</span>
</span></span><span style=display:flex><span>k8s-master-12348451-0                 <span style=color:#ae81ff>90</span>            <span style=color:#ae81ff>90</span>                <span style=color:#ae81ff>14</span>
</span></span></code></pre></div></li><li><gcds-text character-limit=true>Take a look at the pods running in a specific nodepool to see if there are any pods that are not scheduling due to a bad image name or Jobs from a CronJob that are not completing:</gcds-text>
<gcds-text character-limit=true><code>kubectl get pods --all-namespaces -o wide --field-selector spec.nodeName=&lt;node name here></code></gcds-text></li><li><gcds-text character-limit=true>Autoscaling is configured for the nodepools so new nodes should come in (up to a configured maximum) to accomodate the increased number of workloads.</gcds-text></li></ul><gcds-date-modified lang=en>0001-01-01</gcds-date-modified></section></gcds-grid></gcds-container></main><gcds-footer lang=en display=compact contextual-heading=Aurora contextual-links='{ "Contact us": "/contact","Report an issue": "https://github.com/gccloudone/aurora/issues/new/choose","About us": "/about" }'></gcds-footer><script src=https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js></script><script>const style=document.createElement("style");style.innerHTML=`
    .glightbox-container.glightbox-custom-white-bg img {
      background: white !important;
    }
  `,document.head.appendChild(style);const lightbox=GLightbox({openEffect:"zoom",closeEffect:"fade",skin:"custom-white-bg"})</script></body></html>