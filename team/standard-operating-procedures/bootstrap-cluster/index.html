<!doctype html><html dir=ltr lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=5"><title>Bootstrap Cluster | Aurora
</title><link rel=icon href=/favicon.ico type=image/x-icon><link rel=preload href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css as=style crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.design-system.alpha.canada.ca/@cdssnc/gcds-utility@1.9.3/dist/gcds-utility.min.css><link rel=stylesheet href=https://cdn.design-system.alpha.canada.ca/@cdssnc/gcds-components@0.41.0/dist/gcds/gcds.css><script async type=module src=https://cdn.design-system.alpha.canada.ca/@cdssnc/gcds-components@0.41.0/dist/gcds/gcds.esm.js></script><link rel=stylesheet href=/scss/main.css><link rel=stylesheet href=/scss/custom.css><style>html{font-size:16px}body{font-size:var(--gcds-font-sizes-text);line-height:var(--gcds-line-heights-text);color:var(--gcds-color-grayscale-1000);font-family:var(--gcds-font-families-body),sans-serif;margin:0;animation:fade .05s forwards ease-in-out}</style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css></head><body style=margin:0 class=character-limit><main><gcds-container centered size=md><gcds-text size=caption style="text-align: center;"><strong>Alpha</strong>&nbsp;&nbsp;This is an experimental service.</gcds-text>
</gcds-container><gcds-header lang=en lang-href signature-variant=colour skip-to-href=#><gcds-search lang=en slot=search action=/sr/srb.html placeholder=Aurora></gcds-search><gcds-top-nav slot=menu label="Top navigation" alignment=right><gcds-nav-link href=/ slot=home>GC Cloud One: Aurora
</gcds-nav-link><gcds-nav-group open-trigger=Platform menu-label=Platform><gcds-nav-link href=/proposal>Proposal
</gcds-nav-link><gcds-nav-link href=/vision>Vision
</gcds-nav-link><gcds-nav-link href=/architecture>Architecture
</gcds-nav-link></gcds-nav-group><gcds-nav-group open-trigger=Team menu-label=Team><gcds-nav-link href=/team/sop>Standard Operating Procedures
</gcds-nav-link></gcds-nav-group><gcds-nav-group open-trigger=Community menu-label=Community><gcds-nav-link href=/get-involved>Get involved
</gcds-nav-link><gcds-nav-link href=/rules-of-engagement>Rules of Engagement
</gcds-nav-link><gcds-nav-link href=/technical-advisory-group>Technical Advisory Group
</gcds-nav-link></gcds-nav-group><gcds-nav-link href=/contact slot>Contact us
</gcds-nav-link></gcds-top-nav><gcds-breadcrumbs slot=breadcrumb><gcds-breadcrumbs-item href="https://hosting-services-hebergement.canada.ca/s/gc-cloud-one?language=en_US">GC Cloud One</gcds-breadcrumbs-item>
<gcds-breadcrumbs-item href=/>Aurora</gcds-breadcrumbs-item>
<gcds-breadcrumbs-item href=/team/>Team Guide</gcds-breadcrumbs-item>
<gcds-breadcrumbs-item href=/team/standard-operating-procedures/>Standard Operating Procedures</gcds-breadcrumbs-item>
</gcds-breadcrumbs></gcds-header><gcds-container size=xl main-container centered tag=main><gcds-grid tag=section columns=1fr columns-desktop="
        1fr 3fr
      " align-items=start class=hydrated><aside role=complementary><gcds-side-nav label="Team Guide"><gcds-nav-link href=/team/>Team Guide
</gcds-nav-link><gcds-nav-group open-trigger="Standard Operating Procedures" menu-label="Standard Operating Procedures" open><gcds-nav-link href=/team/standard-operating-procedures/>Standard Operating Procedures
</gcds-nav-link><gcds-nav-link href=/team/standard-operating-procedures/backup-disaster-recovery/>Backup and Disaster Recovery
</gcds-nav-link><gcds-nav-link href=/team/standard-operating-procedures/bootstrap-cluster/ current=true>Bootstrap Cluster
</gcds-nav-link><gcds-nav-link href=/team/standard-operating-procedures/infrastructure-and-configuration-management/>Infrastructure and Configuration Management
</gcds-nav-link><gcds-nav-link href=/team/standard-operating-procedures/issue-naming/>Issue and PR Naming Conventions
</gcds-nav-link><gcds-nav-link href=/team/standard-operating-procedures/enterprise-landing-zone/>Onboarding process for the Enterprise Landing Zone</gcds-nav-link></gcds-nav-group></gcds-side-nav></aside><section class=mb-400><gcds-heading tag=h1>Bootstrap Cluster</gcds-heading>
<gcds-alert alert-role=danger container=full heading="Avis de traduction" hide-close-btn=true hide-role-icon=false is-fixed=false class="hydrated mb-400"><gcds-text>Veuillez noter que ce document est actuellement en cours de développement actif et pourrait être sujet à des révisions. Une fois terminé, il sera entièrement traduit en français et mis à disposition dans sa version finale.</gcds-text>
</gcds-alert><gcds-text character-limit=true>This guide covers creating a local k3s bootstrap cluster (also tested in Windows Subsystem for Linux / WSL), installing Argo CD, and transferring control to a remote Kubernetes cluster (the “target” cluster).</gcds-text>
<gcds-text character-limit=true>The bootstrap cluster solves the classic chicken-and-egg problem by allowing Argo CD to install baseline components (e.g., Cilium, namespaces, secrets, policies) on a cluster that initially lacks them.</gcds-text><blockquote><gcds-text character-limit=true>Once the target cluster is ready, Argo CD can deploy itself into that cluster and the bootstrap cluster can be discarded. The target cluster typically becomes the long-term management cluster, meaning bootstrapping is usually a one-time process.</gcds-text></blockquote><gcds-heading tag=h2 id=scope--assumptions character-limit=true>Scope & Assumptions</gcds-heading>
<gcds-text character-limit=true>This guide is written with the following context in mind:</gcds-text><ul><li>The Aurora platform, configured via Argo CD, is first deployed into a temporary local k3s bootstrap cluster and then migrated to the target managed Kubernetes cluster</li><li>The target cluster starts without a CNI (e.g., Cilium); the bootstrap process installs networking and other baseline components</li><li>Sensitive values (credentials, tokens, etc.) are retrieved from Azure Key Vault through a Managed Service Identity (MSI)</li><li>Argo CD and its supporting resources run in the namespace platform-management-system</li></ul><gcds-text character-limit=true>This guide does not cover provisioning of landing zones, subscription-level configuration, or Argo CD operations</gcds-text>
<gcds-heading tag=h2 id=prerequisites character-limit=true>Prerequisites</gcds-heading>
<gcds-text character-limit=true>The following must be in place before you begin the onboarding steps:</gcds-text><ul><li>A <strong>Linux / WSL</strong> environment with <code>bash</code> available</li><li>Required CLI tools installed and accessible: <strong>kubectl</strong>, <strong>k3d</strong> (for local k3s), <strong>jq</strong>, <strong>helm</strong>, <strong>git</strong>, <strong>Azure CLI</strong><ul><li>Verify <strong>jq</strong> is installed and working (<code>apt install jq -y</code> or equivalent)</li></ul></li><li>Any previous kubeconfig context cleared or unset (to avoid conflicts)</li><li>Access to <strong>Azure Key Vault</strong> secrets through a <strong>Managed Service Identity (MSI)</strong> with reader/appropriate permissions</li><li>The Aurora repository cloned locally with the following prepared:<ul><li><code>.env</code> file based on <code>.env.example</code></li><li><code>base/argocd-instance.yaml</code> configured for your environment</li></ul></li></ul><blockquote><gcds-text character-limit=true>If any of these prerequisites are missing, resolve them before proceeding with the bootstrap steps.</gcds-text></blockquote><gcds-heading tag=h2 id=1-configuration-of-the-env-file character-limit=true>1. Configuration of the .env file</gcds-heading>
<gcds-text character-limit=true>Create a <code>.env</code> file alongside the bootstrap scripts.</gcds-text>
<gcds-text character-limit=true>For users with appropriate RBAC the MSI can be added via the script:</gcds-text><pre tabindex=0><code class=language-dotenv data-lang=dotenv>MSI=&#34;00000000-0000-0000-0000-000000000000&#34;   # If MSI already exists
</code></pre><gcds-text character-limit=true>However while a custom role is being developed by the Azure Cloud team the MSI will needed to be added by them:</gcds-text><pre tabindex=0><code class=language-dotenv data-lang=dotenv>MSI_RESOURCE_ID=&#34;/subscriptions/&lt;SUB&gt;/resourceGroups/&lt;RG&gt;/providers/Microsoft.ManagedIdentity/userAssignedIdentities/XXXX-XXXXX-ARGO-msi-argocd&#34;
</code></pre><blockquote><gcds-text character-limit=true>TODO: The Azure Cloud team is developing a custom role to avoid requiring their intervention.</gcds-text></blockquote><gcds-heading tag=h2 id=2-create-the-bootstrap-cluster character-limit=true>2. Create the Bootstrap Cluster</gcds-heading>
<gcds-text character-limit=true>At this point you should be able to successfully run the setup script in the bootstrap cluster repository.</gcds-text><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./setup.sh
</span></span></code></pre></div><blockquote><gcds-text character-limit=true><strong>Note:</strong> You may need to manually delete an existing secret (<code>project-aurora-mgmt</code>) if it conflicts.</gcds-text></blockquote><gcds-heading tag=h2 id=3-set-your-kube-context character-limit=true>3. Set your Kube Context</gcds-heading>
<gcds-text character-limit=true>Ensure kubectl is pointed at the bootstrap cluster.</gcds-text>
<gcds-text character-limit=true>By default, the setup script creates a local kubeconfig file named .kubeconfig.</gcds-text>
<gcds-text character-limit=true>Export the kubeconfig for the current shell session:</gcds-text><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>export KUBECONFIG<span style=color:#f92672>=</span>.kubeconfig
</span></span></code></pre></div><gcds-text character-limit=true>Verify you are connected to the bootstrap cluster:</gcds-text><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get nodes
</span></span></code></pre></div><gcds-text character-limit=true>Continue only if you see the bootstrap cluster nodes listed.</gcds-text>
<gcds-heading tag=h2 id=4-custom-certificate-authority-ca character-limit=true>4. Custom Certificate Authority (CA)</gcds-heading>
<gcds-text character-limit=true>If your environment requires a Custom Certificate Authority (CA) and you must apply it to the bootstrap cluster so Argo CD and related components can establish TLS connections.</gcds-text><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl apply -f certs.yaml
</span></span><span style=display:flex><span>kubectl rollout restart deploy -n platform-management-system
</span></span></code></pre></div><gcds-text character-limit=true>The certs.yaml file should define a ConfigMap similar to the following:</gcds-text><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>custom-certs</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>platform-management-system</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>custom.crt</span>: |-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    -----BEGIN CERTIFICATE-----
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    XXXXX
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    -----END CERTIFICATE-----</span>
</span></span></code></pre></div><gcds-heading tag=h2 id=5-update-argo-cd-configuration character-limit=true>5. Update Argo CD Configuration</gcds-heading>
<gcds-text character-limit=true>At this stage, Argo CD must be updated to point to the correct repository and configuration.</gcds-text><ul><li>Update the repo specification in
<gcds-link href=https://github.com/gccloudone-aurora/bootstrap-cluster/blob/main/base/argocd-instance.yaml>argocd-instance.yaml</gcds-link> so that Argo CD syncs from the correct Aurora repo.</li><li>Switch to the aurora-svc service account and grant a Personal Access Token (PAT) with access to the new repo. This ensures Argo CD can authenticate and pull manifests.</li><li>Approve the gccloudone-aurora request under pending repository access requests in your GitHub organization, so Argo CD has full read permissions.</li></ul><gcds-date-modified lang=en>2025-08-19</gcds-date-modified></section></gcds-grid></gcds-container></main><gcds-footer lang=en display=compact contextual-heading=Aurora contextual-links='{ "Contact us": "/contact","Report an issue": "https://github.com/gccloudone/aurora/issues/new/choose","About us": "/about" }'></gcds-footer><script src=https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js></script><script>const style=document.createElement("style");style.innerHTML=`
    .glightbox-container.glightbox-custom-white-bg img {
      background: white !important;
    }
  `,document.head.appendChild(style);const lightbox=GLightbox({openEffect:"zoom",closeEffect:"fade",skin:"custom-white-bg"})</script></body></html>