<!doctype html><html dir=ltr lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=5"><title>Bootstrap Cluster | Aurora
</title><link rel=icon href=/favicon.ico type=image/x-icon><link rel=preload href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css as=style crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.design-system.alpha.canada.ca/@cdssnc/gcds-utility@1.9.3/dist/gcds-utility.min.css><link rel=stylesheet href=https://cdn.design-system.alpha.canada.ca/@cdssnc/gcds-components@0.41.0/dist/gcds/gcds.css><script async type=module src=https://cdn.design-system.alpha.canada.ca/@cdssnc/gcds-components@0.41.0/dist/gcds/gcds.esm.js></script><link rel=stylesheet href=/scss/main.css><link rel=stylesheet href=/scss/custom.css><style>html{font-size:16px}body{font-size:var(--gcds-font-sizes-text);line-height:var(--gcds-line-heights-text);color:var(--gcds-color-grayscale-1000);font-family:var(--gcds-font-families-body),sans-serif;margin:0;animation:fade .05s forwards ease-in-out}</style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css></head><body style=margin:0 class=character-limit><main><gcds-container centered size=md><gcds-text size=caption style="text-align: center;"><strong>Alpha</strong>&nbsp;&nbsp;This is an experimental service.</gcds-text>
</gcds-container><gcds-header lang=en lang-href signature-variant=colour skip-to-href=#><gcds-search lang=en slot=search action=/sr/srb.html placeholder=Aurora></gcds-search><gcds-top-nav slot=menu label="Top navigation" alignment=right><gcds-nav-link href=/ slot=home>GC Cloud One: Aurora
</gcds-nav-link><gcds-nav-group open-trigger=Platform menu-label=Platform><gcds-nav-link href=/proposal>Proposal
</gcds-nav-link><gcds-nav-link href=/vision>Vision
</gcds-nav-link><gcds-nav-link href=/architecture>Architecture
</gcds-nav-link></gcds-nav-group><gcds-nav-group open-trigger=Team menu-label=Team><gcds-nav-link href=/team/sop>Standard Operating Procedures
</gcds-nav-link></gcds-nav-group><gcds-nav-group open-trigger=Community menu-label=Community><gcds-nav-link href=/get-involved>Get involved
</gcds-nav-link><gcds-nav-link href=/rules-of-engagement>Rules of Engagement
</gcds-nav-link><gcds-nav-link href=/technical-advisory-group>Technical Advisory Group
</gcds-nav-link></gcds-nav-group><gcds-nav-link href=/contact slot>Contact us
</gcds-nav-link></gcds-top-nav><gcds-breadcrumbs slot=breadcrumb><gcds-breadcrumbs-item href="https://hosting-services-hebergement.canada.ca/s/gc-cloud-one?language=en_US">GC Cloud One</gcds-breadcrumbs-item>
<gcds-breadcrumbs-item href=/>Aurora</gcds-breadcrumbs-item>
<gcds-breadcrumbs-item href=/team/>Team Guide</gcds-breadcrumbs-item>
<gcds-breadcrumbs-item href=/team/standard-operating-procedures/>Standard Operating Procedures</gcds-breadcrumbs-item>
</gcds-breadcrumbs></gcds-header><gcds-container size=xl main-container centered tag=main><gcds-grid tag=section columns=1fr columns-desktop="
        1fr 3fr
      " align-items=start class=hydrated><aside role=complementary><gcds-side-nav label="Team Guide"><gcds-nav-link href=/team/>Team Guide
</gcds-nav-link><gcds-nav-group open-trigger="Standard Operating Procedures" menu-label="Standard Operating Procedures" open><gcds-nav-link href=/team/standard-operating-procedures/>Standard Operating Procedures
</gcds-nav-link><gcds-nav-link href=/team/standard-operating-procedures/backup-disaster-recovery/>Backup and Disaster Recovery
</gcds-nav-link><gcds-nav-link href=/team/standard-operating-procedures/bootstrap-cluster/ current=true>Bootstrap Cluster
</gcds-nav-link><gcds-nav-link href=/team/standard-operating-procedures/infrastructure-and-configuration-management/>Infrastructure and Configuration Management
</gcds-nav-link><gcds-nav-link href=/team/standard-operating-procedures/issue-naming/>Issue and PR Naming Conventions
</gcds-nav-link><gcds-nav-link href=/team/standard-operating-procedures/enterprise-landing-zone/>Onboarding process for the Enterprise Landing Zone</gcds-nav-link></gcds-nav-group></gcds-side-nav></aside><section class=mb-400><gcds-heading tag=h1>Bootstrap Cluster</gcds-heading>
<gcds-alert alert-role=danger container=full heading="Avis de traduction" hide-close-btn=true hide-role-icon=false is-fixed=false class="hydrated mb-400"><gcds-text>Veuillez noter que ce document est actuellement en cours de développement actif et pourrait être sujet à des révisions. Une fois terminé, il sera entièrement traduit en français et mis à disposition dans sa version finale.</gcds-text>
</gcds-alert><gcds-text character-limit=true>This guide covers creating a local k3s bootstrap cluster (also tested in Windows Subsystem for Linux / WSL), installing Argo CD, and transferring control to a remote Kubernetes cluster (the “target” cluster).</gcds-text>
<gcds-text character-limit=true>The bootstrap cluster solves the classic chicken-and-egg problem by allowing Argo CD to install baseline components (e.g., Cilium, namespaces, secrets, policies) on a cluster that initially lacks them.</gcds-text><blockquote><gcds-text character-limit=true>Once the target cluster is ready, Argo CD can deploy itself into that cluster and the bootstrap cluster can be discarded. The target cluster typically becomes the long-term management cluster, meaning bootstrapping is usually a one-time process.</gcds-text></blockquote><gcds-heading tag=h2 id=scope--assumptions character-limit=true>Scope & Assumptions</gcds-heading>
<gcds-text character-limit=true>This guide is written with the following context in mind:</gcds-text><ul><li>The Aurora platform, configured via Argo CD, is first deployed into a temporary local k3s bootstrap cluster and then migrated to the target managed Kubernetes cluster</li><li>The target cluster starts without a CNI (e.g., Cilium); the bootstrap process installs networking and other baseline components</li><li>Sensitive values (credentials, tokens, etc.) are retrieved from Azure Key Vault through a Managed Service Identity (MSI)</li><li>Argo CD and its supporting resources run in the namespace platform-management-system</li></ul><gcds-text character-limit=true>This guide does not cover provisioning of landing zones, subscription-level configuration, or Argo CD operations</gcds-text>
<gcds-heading tag=h2 id=prerequisites character-limit=true>Prerequisites</gcds-heading>
<gcds-text character-limit=true>The following must be in place before you begin the onboarding steps:</gcds-text><ul><li>A Linux / WSL environment with bash, on a VM capable of mounting a <strong>Managed Service Identity (MSI)</strong></li><li>Required CLI tools installed and accessible: <strong>kubectl</strong>, <strong>k3d</strong> (for local k3s), <strong>jq</strong>, <strong>helm</strong>, <strong>git</strong>, <strong>Azure CLI</strong><ul><li>Verify <strong>jq</strong> is installed and working (<code>apt install jq -y</code> or equivalent)</li></ul></li><li>Any previous kubeconfig context cleared or unset (to avoid conflicts)</li><li>The Aurora
<gcds-link href=https://github.com/gccloudone-aurora/bootstrap-cluster>bootstrap-cluster</gcds-link> repository cloned locally with the following prepared:<ul><li><code>.env</code> file based on <code>.env.example</code></li><li><code>base/argocd-instance.yaml</code> configured for your environment</li></ul></li></ul><blockquote><gcds-text character-limit=true>If any of these prerequisites are missing, resolve them before proceeding with the bootstrap steps.</gcds-text></blockquote><gcds-heading tag=h2 id=1-configuration-of-the-env-file character-limit=true>1. Configuration of the .env file</gcds-heading>
<gcds-text character-limit=true>Create a <code>.env</code> file alongside the bootstrap scripts by copying the .env.example file and configuring it.</gcds-text>
<gcds-text character-limit=true>For users with appropriate RBAC the MSI can be added via the script:</gcds-text><pre tabindex=0><code class=language-dotenv data-lang=dotenv>MSI=&#34;00000000-0000-0000-0000-000000000000&#34;   # If MSI already exists
</code></pre><gcds-text character-limit=true>For users without the appropriate RBAC the MSI can only be added in advance by the Azure Cloud Team.</gcds-text><pre tabindex=0><code class=language-dotenv data-lang=dotenv>MSI_RESOURCE_ID=&#34;/subscriptions/&lt;SUB&gt;/resourceGroups/&lt;RG&gt;/providers/Microsoft.ManagedIdentity/userAssignedIdentities/XXXX-XXXXX-ARGO-msi-argocd&#34;
</code></pre><blockquote><gcds-text character-limit=true>TODO: The Azure Cloud team is developing a custom role to remove this manual step. Until then, the managed identity XXXX-XXXXX-ARGO-msi-argocd created during Enterprise Landing Zone (ESLZ) onboarding must be manually added to the jumpbox.</gcds-text></blockquote><gcds-heading tag=h2 id=2-update-your-project-level-configuration character-limit=true>2. Update Your Project-Level Configuration</gcds-heading>
<gcds-text character-limit=true>Start by cloning the Aurora project template:</gcds-text><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/gccloudone-aurora/project-aurora-template.git
</span></span></code></pre></div><gcds-text character-limit=true>Each cluster will have its own <code>config.yaml</code> located under:</gcds-text><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>platform/clusters/non-prod/&lt;cluster-name&gt;/config.yaml
</span></span><span style=display:flex><span>platform/clusters/prod/&lt;cluster-name&gt;/config.yaml
</span></span></code></pre></div><gcds-text character-limit=true>Edit the <code>config.yaml</code> for your target cluster to match your environment. This file tells Argo CD what to deploy and how to manage the cluster, making it the central configuration for the Aurora platform.</gcds-text>
<gcds-text character-limit=true>In most environments, you will need to update:</gcds-text><ul><li><strong>App-of-apps configuration</strong> – adjust which components are deployed and how they sync</li><li><strong>Networking and identity</strong> – API server CIDRs, ingress domain, subscription/tenant IDs, Key Vault references</li><li><strong>Core components</strong> – toggle services like Cilium, cert-manager, and CIDR allocator</li></ul><gcds-text character-limit=true>Finally, commit and push your changes to a repository. We typically use a naming convention such as project-example-aur, and for client workloads we always suffix the repository name with the -aur shortcode.</gcds-text>
<gcds-heading tag=h2 id=3-update-argo-cd-configuration character-limit=true>3. Update Argo CD Configuration</gcds-heading>
<gcds-text character-limit=true>At this stage, Argo CD in the bootstrap cluster must be updated so it can track the repository you prepared in the previous step.</gcds-text><ul><li><strong>Update the repository specification</strong> in
<gcds-link href=https://github.com/gccloudone-aurora/bootstrap-cluster/blob/main/base/argocd-instance.yaml><code>argocd-instance.yaml</code></gcds-link> so Argo CD syncs from the correct Aurora repo.</li><li><strong>Grant authentication</strong> by switching to the <code>aurora-svc</code> service account and providing a GitHub Personal Access Token (PAT) with access to the repo. This allows Argo CD to pull manifests.</li><li><strong>Approve access</strong> by approving the <code>gccloudone-aurora</code> request under pending repository access requests in your GitHub organization.</li></ul><gcds-heading tag=h2 id=4-create-the-bootstrap-cluster character-limit=true>4. Create the Bootstrap Cluster</gcds-heading>
<gcds-text character-limit=true>At this point you should be able to successfully run the setup script in the bootstrap cluster repository.</gcds-text><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./setup.sh
</span></span></code></pre></div><gcds-text character-limit=true>Once the script fully executes you will be given instructions on how to login to the Argo CD instance.</gcds-text><blockquote><gcds-text character-limit=true>TODO: You may need to manually delete an existing secret (<code>project-aurora-mgmt</code>) if it conflicts.</gcds-text></blockquote><gcds-heading tag=h2 id=5-set-your-kube-context character-limit=true>5. Set your Kube Context</gcds-heading>
<gcds-text character-limit=true>Ensure kubectl is pointed at the bootstrap cluster.</gcds-text>
<gcds-text character-limit=true>By default, the setup script creates a local kubeconfig file named .kubeconfig.</gcds-text>
<gcds-text character-limit=true>Export the kubeconfig for the current shell session:</gcds-text><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>export KUBECONFIG<span style=color:#f92672>=</span>.kubeconfig
</span></span></code></pre></div><gcds-text character-limit=true>Verify you are connected to the bootstrap cluster:</gcds-text><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get nodes
</span></span></code></pre></div><gcds-text character-limit=true>Continue only if you see the bootstrap cluster nodes listed.</gcds-text>
<gcds-heading tag=h2 id=6-custom-certificate-authority-ca-for-local-argo-cd character-limit=true>6. Custom Certificate Authority (CA) for local Argo CD</gcds-heading>
<gcds-text character-limit=true>If your environment requires a Custom Certificate Authority (CA) you must ensure it is applied to the bootstrap cluster so Argo CD and related components can establish TLS connections.</gcds-text><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl apply -f certs.yaml
</span></span><span style=display:flex><span>kubectl rollout restart deploy -n platform-management-system
</span></span></code></pre></div><gcds-text character-limit=true>The certs.yaml file should define a ConfigMap similar to the following:</gcds-text><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>custom-certs</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>platform-management-system</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>custom.crt</span>: |-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    -----BEGIN CERTIFICATE-----
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    XXXXX
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    -----END CERTIFICATE-----</span>
</span></span></code></pre></div><gcds-heading tag=h2 id=7-add-key-vault-secrets character-limit=true>7. Add Key Vault Secrets</gcds-heading>
<gcds-text character-limit=true>At this stage, you must manually add the following secrets into Azure Key Vault so that Argo CD can fully authenticate with its resources and manage the Aurora platform:</gcds-text><ul><li><code>xxxx-xxxxx-argo-kvs-github-password</code></li><li><code>xxxx-xxxxx-argo-kvs-github-username</code></li><li><code>xxxx-xxxxx-argo-kvs-cluster-admins</code></li></ul><blockquote><gcds-text character-limit=true>TODO: This step is required until these values are provisioned automatically as part of the Enterprise Landing Zone (ESLZ) onboarding.</gcds-text></blockquote><gcds-heading tag=h2 id=8-register-target-cluster--transfer-control character-limit=true>8. Register Target Cluster & Transfer Control</gcds-heading>
<gcds-text character-limit=true>Register the target cluster with Argo CD by running:</gcds-text><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./register.sh
</span></span></code></pre></div><gcds-text character-limit=true>This script creates a cluster secret in Argo CD using the values from your .env file and will begin the process of deploying the Aurora platform (with Argo CD itself) into the target cluster.</gcds-text><blockquote><gcds-text character-limit=true>TODO: Please watch out for the duplicate aks-aks problem as you may need to hard-set the context values in .env before running the script.</gcds-text></blockquote><gcds-heading tag=h2 id=9-add-dns-a-record character-limit=true>9. Add DNS A Record</gcds-heading>
<gcds-text character-limit=true>Navigate to the public DNS zone for your cluster created in the Azure Enterprise Landing Zone (ESLZ) onboarding.</gcds-text><ul><li><code>*.aurora</code>: public DNS zone pointing to the load balancer</li></ul><gcds-text character-limit=true>The load balancer is exposed by the service in the <code>ingress-general-system</code> namespace.</gcds-text>
<gcds-heading tag=h2 id=10-custom-certificate-authority-ca-for-target-argo-cd character-limit=true>10. Custom Certificate Authority (CA) for target Argo CD</gcds-heading>
<gcds-text character-limit=true>If you applied a Custom Certificate Authority (CA) to the bootstrap cluster, you must also apply it to the <strong>target cluster</strong>. This ensures Argo CD and related components in the target environment can establish TLS connections.</gcds-text><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl apply -f certs.yaml
</span></span><span style=display:flex><span>kubectl rollout restart deploy -n platform-management-system
</span></span></code></pre></div><gcds-heading tag=h2 id=11-patch-argo-cd-repo-server-for-workload-identity character-limit=true>11. Patch Argo CD Repo-Server for Workload Identity</gcds-heading>
<gcds-text character-limit=true>Because the Argo CD operator does not yet expose workload identity settings, you must manually patch the repo-server deployment to set the identity binding:</gcds-text><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl patch deployment argocd-repo-server <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -n platform-management-system <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -p <span style=color:#e6db74>&#39;{&#34;spec&#34;:{&#34;template&#34;:{&#34;metadata&#34;:{&#34;labels&#34;:{&#34;aadpodidbinding&#34;:&#34;argocd-vault-plugin&#34;}}}}}&#39;</span>
</span></span></code></pre></div><blockquote><gcds-text character-limit=true>Note: This step will no longer be required once the Argo CD operator natively supports workload identity.</gcds-text></blockquote><gcds-heading tag=h2 id=12-destroy-the-bootstrap-cluster character-limit=true>12. Destroy the Bootstrap Cluster</gcds-heading>
<gcds-text character-limit=true>Once the complete Aurora platform is deployed onto the target cluster, and you can log in to the target&rsquo;s Argo CD instance to confirm that all applications are synced, you may safely remove the bootstrap cluster:</gcds-text><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./cleanup.sh
</span></span></code></pre></div><blockquote><gcds-text character-limit=true>Note: Do not remove the bootstrap cluster until you have verified that the Aurora platform is fully deployed and synchronized on the target cluster, and that you can log in to the target Argo CD instance using OIDC.</gcds-text></blockquote><gcds-date-modified lang=en>2025-08-19</gcds-date-modified></section></gcds-grid></gcds-container></main><gcds-footer lang=en display=compact contextual-heading=Aurora contextual-links='{ "Contact us": "/contact","Report an issue": "https://github.com/gccloudone/aurora/issues/new/choose","About us": "/about" }'></gcds-footer><script src=https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js></script><script>const style=document.createElement("style");style.innerHTML=`
    .glightbox-container.glightbox-custom-white-bg img {
      background: white !important;
    }
  `,document.head.appendChild(style);const lightbox=GLightbox({openEffect:"zoom",closeEffect:"fade",skin:"custom-white-bg"})</script></body></html>